---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { useTranslations, localePath } from '../../i18n/index';

const locale = 'en' as const;
const t = useTranslations(locale);

const [articles, posts] = await Promise.all([
  getCollection('articles', ({ data }) => !data.draft),
  getCollection('posts', ({ data }) => !data.draft),
]);

const tagCounts = new Map<string, number>();
for (const entry of [...articles, ...posts]) {
  for (const tag of entry.data.tags) {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  }
}
const tags = Array.from(tagCounts.entries())
  .map(([tag, count]) => ({ tag, count }))
  .sort((a, b) => b.count - a.count || a.tag.localeCompare(b.tag));
---

<BaseLayout title={t('page_tags_heading')} locale={locale}>
  <div class="flex flex-col gap-4">
    <h1 class="text-foreground m-0 mb-2 text-2xl font-bold">{t('page_tags_heading')}</h1>
    <div class="flex flex-wrap gap-2">
      {
        tags.map(({ tag, count }) => (
          <a
            href={localePath(`/tags/${tag}`, locale)}
            class="border-border text-muted hover:border-accent hover:text-accent inline-flex items-center gap-1.5 rounded-full border px-3 py-1 text-sm no-underline transition-colors duration-150"
          >
            <span>#{tag}</span>
            <span class="text-muted text-xs">({count})</span>
          </a>
        ))
      }
      {tags.length === 0 && <p class="text-muted">No tags yet.</p>}
    </div>
  </div>
</BaseLayout>
