---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import ArticleCard from '../../../components/ArticleCard.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../../../i18n/index';
import { entrySlug } from '../../../utils';

export async function getStaticPaths() {
  const articles = await getCollection('articles', ({ data }) => !data.draft);
  const categories = new Set(articles.map((a) => a.data.category).filter(Boolean));
  return Array.from(categories).map((cat) => ({
    params: { category: cat },
    props: {
      category: cat,
      categoryName: articles.find((a) => a.data.category === cat)?.data.categoryName ?? cat,
    },
  }));
}

const { category, categoryName } = Astro.props;
const locale = 'zh-tw' as const;
const t = useTranslations(locale);

const articles = (
  await getCollection('articles', ({ data }) => !data.draft && data.category === category)
).sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime());
---

<BaseLayout title={categoryName} locale={locale}>
  <div class="flex flex-col gap-4">
    <h1 class="text-foreground m-0 mb-2 text-2xl font-bold">{categoryName}</h1>
    {
      articles.map((entry) => (
        <ArticleCard
          title={entry.data.title}
          description={entry.data.description}
          slug={entrySlug(entry.id)}
          publishedAt={entry.data.publishedAt}
          tags={entry.data.tags}
          category={entry.data.category}
          categoryName={entry.data.categoryName}
          locale={locale}
        />
      ))
    }
  </div>
</BaseLayout>
