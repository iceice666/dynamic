---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { useTranslations, localePath } from '../../../i18n/index';

const locale = 'zh-tw' as const;
const t = useTranslations(locale);

const articles = await getCollection('articles', ({ data }) => !data.draft);

const categoryMap = new Map<string, { name: string; count: number }>();
for (const article of articles) {
  const slug = article.data.category;
  const name = article.data.categoryName;
  if (slug && name) {
    const existing = categoryMap.get(slug);
    if (existing) {
      existing.count++;
    } else {
      categoryMap.set(slug, { name, count: 1 });
    }
  }
}
const categories = Array.from(categoryMap.entries())
  .map(([slug, { name, count }]) => ({ slug, name, count }))
  .sort((a, b) => b.count - a.count);
---

<BaseLayout title={t('page_categories_heading')} locale={locale}>
  <div class="flex flex-col gap-4">
    <h1 class="text-foreground m-0 mb-2 text-2xl font-bold">{t('page_categories_heading')}</h1>
    <div class="flex flex-col gap-2">
      {
        categories.map((cat) => (
          <a
            href={localePath(`/categories/${cat.slug}`, locale)}
            class="border-border bg-background hover:bg-muted-bg flex items-center justify-between rounded-lg border p-4 no-underline transition-colors duration-150"
          >
            <span class="text-foreground font-medium">{cat.name}</span>
            <span class="text-muted text-sm">{cat.count}</span>
          </a>
        ))
      }
      {categories.length === 0 && <p class="text-muted">No categories yet.</p>}
    </div>
  </div>
</BaseLayout>
