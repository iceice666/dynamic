---
import { localePath, useTranslations } from '../i18n/index';
import type { Locale } from '../i18n/ui';

interface Props {
  title: string;
  description?: string;
  slug: string;
  publishedAt: Date;
  tags: string[];
  category?: string;
  categoryName?: string;
  locale: Locale;
}

const { title, description, slug, publishedAt, tags, categoryName, locale } = Astro.props;
const t = useTranslations(locale);

function formatDate(date: Date) {
  const yyyy = date.getFullYear();
  const mm = String(date.getMonth() + 1).padStart(2, '0');
  const dd = String(date.getDate()).padStart(2, '0');
  return `${yyyy}/${mm}/${dd}`;
}

const articlePath = localePath(`/articles/${slug}`, locale);
---

<article
  class="border-border bg-background hover:bg-muted-bg flex flex-col gap-2 rounded-lg border p-4 transition-colors duration-150"
>
  <div class="text-muted text-[0.6875rem] font-semibold tracking-[0.08em] uppercase">
    {categoryName ? `${t('article_label')} Â· ${categoryName}` : t('article_label')}
  </div>
  <h2 class="m-0 text-[1.0625rem] leading-[1.3] font-bold">
    <a
      href={articlePath}
      class="text-foreground hover:text-accent no-underline transition-colors duration-150"
      >{title}</a
    >
  </h2>
  {
    description && (
      <p class="excerpt text-muted m-0 overflow-hidden text-sm leading-normal">{description}</p>
    )
  }
  <div class="flex flex-wrap items-center gap-2">
    <div class="flex flex-wrap gap-1.5">
      {
        tags.map((tag) => (
          <a
            href={localePath(`/tags/${tag}`, locale)}
            class="text-accent text-xs no-underline transition-opacity duration-150 hover:opacity-75"
          >
            #{tag}
          </a>
        ))
      }
    </div>
    <div class="flex-1"></div>
    <time class="text-muted text-xs" datetime={publishedAt.toISOString()}
      >{formatDate(publishedAt)}</time
    >
  </div>
</article>

<style>
  .excerpt {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
  }
</style>
