---
import type { Friend, SocialLink } from '../types';
import * as LucideIcons from 'lucide-react';
import type { LucideIcon } from 'lucide-react';

interface Props {
  friend: Friend;
}

const { friend } = Astro.props;

function socialHref(link: SocialLink): string {
  if (link.kind === 'email') return `mailto:${link.address}`;
  return link.url;
}

function socialIcon(link: SocialLink): LucideIcon {
  const icons: Record<SocialLink['kind'], LucideIcon> = {
    website: LucideIcons['Globe'],
    github: LucideIcons['Github'],
    gitlab: LucideIcons['Gitlab'],
    git: LucideIcons['GitBranch'],
    twitter: LucideIcons['Twitter'],
    linkedin: LucideIcons['Linkedin'],
    rss: LucideIcons['Rss'],
    facebook: LucideIcons['Facebook'],
    instagram: LucideIcons['Instagram'],
    threads: LucideIcons['MessageCircle'],
    youtube: LucideIcons['Youtube'],
    email: LucideIcons['Mail'],
  };

  return icons[link.kind];
}
---

<article
  class="border-border bg-background hover:bg-muted-bg rounded-lg border p-4 transition-colors duration-150"
>
  <div class="flex items-start gap-3">
    <a href={friend.url} target="_blank" rel="noopener noreferrer" class="shrink-0">
      <img
        class="border-border block h-12 w-12 rounded-full border-2 object-cover"
        src={friend.img}
        alt={`${friend.name} avatar`}
        width="48"
        height="48"
      />
    </a>
    <div class="flex min-w-0 flex-col gap-1">
      <a
        href={friend.url}
        target="_blank"
        rel="noopener noreferrer"
        class="text-foreground hover:text-accent flex items-center gap-1 text-[0.9375rem] font-semibold no-underline transition-colors duration-150"
      >
        {friend.name}
        <LucideIcons.ExternalLink size={14} className="shrink-0" aria-hidden="true" />
      </a>
      <p class="text-muted m-0 text-sm leading-relaxed">
        {friend.desc}
      </p>
      <div class="mt-0.5 flex gap-2">
        {
          friend.socials.map((link) => (
            <a
              href={socialHref(link)}
              class="text-muted hover:text-accent flex items-center transition-colors duration-150"
              aria-label={link.kind}
              target={link.kind === 'email' ? undefined : '_blank'}
              rel={link.kind === 'email' ? undefined : 'noopener noreferrer'}
            >
              {(() => {
                const Icon = socialIcon(link);
                return <Icon size={16} className="shrink-0" aria-hidden="true" />;
              })()}
            </a>
          ))
        }
      </div>
    </div>
  </div>
</article>
