---
import { t } from '$/i18n';
import ArticleViewCount from '$/components/widgets/ArticleViewCount';
import { formatDate, formatCategory } from '$/utils';
import { BookOpen, Clock } from 'lucide-react';

interface Props {
  title: string;
  description?: string;
  slug: string;
  publishedAt: Date;
  tags: string[];
  category?: string;
  wordCount?: number;
  readingTime?: number;
  translationLang?: string;
}

const {
  title,
  description,
  slug,
  publishedAt,
  tags,
  category,
  wordCount,
  readingTime,
  translationLang,
} = Astro.props;
const { locale } = Astro.locals;

const articlePath = translationLang
  ? `/articles/${slug}?lang=${translationLang}`
  : `/articles/${slug}`;
---

<article class="card">
  <div class="label-uppercase">
    {t(locale, 'article_label')}
    {category && ` Â· ${formatCategory(category)}`}
    {
      translationLang && (
        <span class="border-border ml-1.5 rounded border px-1 py-0.5 text-[0.6rem] font-semibold tracking-wider uppercase opacity-60">
          {translationLang}
        </span>
      )
    }
  </div>
  <h2 class="m-0 text-[1.0625rem] leading-[1.3] font-bold">
    <a href={articlePath} class="link-accent">{title}</a>
  </h2>
  {
    description && (
      <p class="excerpt text-muted m-0 overflow-hidden text-sm leading-normal">{description}</p>
    )
  }
  {
    (wordCount || readingTime) && (
      <div class="flex flex-wrap items-center gap-x-3 gap-y-1">
        {wordCount != null && wordCount > 0 && (
          <span class="text-muted flex items-center gap-1 text-xs">
            <BookOpen size={12} aria-hidden="true" />
            <span>
              {wordCount.toLocaleString()} {t(locale, 'article_word_count')}
            </span>
          </span>
        )}
        {readingTime != null && (
          <span class="text-muted flex items-center gap-1 text-xs">
            <Clock size={12} aria-hidden="true" />
            <span>
              {readingTime} {t(locale, 'article_read_time')}
            </span>
          </span>
        )}
        <ArticleViewCount client:idle path={articlePath} />
      </div>
    )
  }
  <div class="flex flex-wrap items-center gap-2">
    <div class="flex flex-wrap gap-1.5">
      {
        tags.map((tag) => (
          <a href={`/search?q=%23${tag}`} class="tag-link">
            #{tag}
          </a>
        ))
      }
    </div>
    <div class="flex-1"></div>
    <time class="text-muted text-xs" datetime={publishedAt.toISOString()}
      >{formatDate(publishedAt)}</time
    >
  </div>
</article>
